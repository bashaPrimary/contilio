### Version Control System Database Migrations

[Alembic](https://alembic.sqlalchemy.org/en/latest/tutorial.html) is a migrations tool used to run data migrations into 
our sqllite journey planner database.
The first script under `migrations/versions` adds the base `Journey/Route/JourneyRoutes` tables.
This folder also holds/will hold every migration to be executed in order of the revision id prefixed to the file name.

#### :information_source: To add a new migration script:
Within the journey_planner directory, and after making your local change to the JP schema, i.e. to `model.py`,
run

```
poetry run alembic revision --autogenerate -m "Reasonable title for the migration to be run"
```
To ensure your local db is up-to-date with the latest migrations run;

`poetry run alembic upgrade head`

If you want to try out the effect of running a migration up and then down you can use

```
poetry run alembic upgrade +1
```
and then to downgrade
```
poetry run alembic downgrade -1
```

This is quite useful when creating a migration to be able to test out its effect. Note the example
shows running a single migration up and down but you can swap out that number for however many you
need to run.

Or to test a specific revision
```
poetry run alembic upgrade 50ca0b336fb5
```
and
```
poetry run alembic downgrade 50ca0b336fb5
```

#### Alembic config:
When running `alembic init` for the first time, autogenerated files include:
* `alembic.ini` at root folder: This is a file that the alembic script looks for when invoked
and contains any necessary configurations, also can be manually updated.
* `env.py` under journey_planner directory: the python script for actually triggering the migrations, using env variables specified
* `script.py.mako`: This is a `Mako` template file which is used to generate new migration scripts
All configuration required for alembic to run smoothly is under `alembic.ini` and `src/journey_planner/migrations`.


[Youtube tutorial on alembic!](https://www.youtube.com/watch?v=xzsbHMHYI5c)
